<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Ruslan Osipov</title>
  <meta name="author" content="Ruslan Osipov">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.rosipov.com/posts/15/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Ruslan Osipov" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://www.rosipov.com/posts/15/">
  <meta property="og:title" content="Ruslan Osipov">
  

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<script src="/javascripts/libs/jquery/jquery-2.1.3.min.js"></script>


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48506044-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Ruslan Osipov</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/about">About</a>
                </li>
                <li >
                    <a href="/blog/archive">Archive</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="www.rosipov.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Ruslan Osipov" />
    
    <meta itemprop="url" content="http://www.rosipov.com" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-12-30T18:48:31+00:00"  data-updated="true" itemprop="datePublished dateCreated">30 Dec 2013</time>
        
           | <a href="/blog/making-django-and-lettuce-play-nice-together/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/making-django-and-lettuce-play-nice-together/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/making-django-and-lettuce-play-nice-together/" itemprop="url">Making Django and Lettuce play nice together</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Lettuce is a great BDD tool which allows you to parse expressions written via
Gherkin syntax in python. However the documentation is not very comprehensive,
and at the moment current version (0.2.19) has some issues integrating with the
latest Django (1.6.1 at the moment of writing). Without further ado, I&rsquo;ll get
to a comprehensive tutorial.</p>

<p>Let&rsquo;s assume you are using <code>pip</code> and <code>virtualenv</code> for the dependency control,
and you already have a working project configured. Your project is called
&ldquo;myproject&rdquo;, and the only app you have within your project is called &ldquo;polls&rdquo;.</p>

<h2>Setup</h2>

<p>First, you have to install <code>lettuce</code> library. At the moment of writing, current
released version (0.2.19) has an error integrating with Django, so we&rsquo;ll
install current development version. Releases 0.2.20 and up should include the
fix, so <code>pip install lettuce</code> would be better if the version is out.</p>

<pre><code>pip install -e \
    git://github.com/gabrielfalcao/lettuce@cccc397#egg=lettuce-master
pip install django-nose splinter
pip freeze &gt; requirements.txt
</code></pre>

<p>First line downloads lettuce package from the github repository and installs
missing dependencies. You can replace <code>cccc397</code> with the current commit.
Technically commit can be omitted, but we don&rsquo;t want to have an unstable
ever-changing branch in our <code>requirements.txt</code>. I also added <code>django-nose</code>
since nose assertions come in handy while writing Lettuce steps, as well as
<code>splinter</code>, which is a great tool for testing web application.</p>

<p>Add Lettuce to the <code>INSTALLED_APPS</code> in your <code>myproject/settings.py</code>:</p>

<pre><code>INSTALLED_APPS = (
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.sites',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'django.contrib.admin',
    'django.contrib.admindocs',
    # ... third party apps ...
    'lettuce.django',
    'myproject',
    'polls',
)
</code></pre>

<p>You also have to explicitly specify the apps you want to use with lettuce:</p>

<pre><code>LETTUCE_APPS = (
    'polls',
)
</code></pre>

<p>By default, lettuce will run its&#8217; tests against your default database. But we
want to use test database for that, so we have to add few more settings:</p>

<pre><code>LETTUCE_TEST_SERVER = 'lettuce.django.server.DjangoServer'
LETTUCE_SERVER_PORT = 9000
</code></pre>

<p>Where <code>LETTUCE_TEST_SERVER</code> is a subclass of Django&rsquo;s <code>LiveTestServerCase</code> - a
class which runs a test server for you and <code>LETTUCE_SERVER_PORT</code> is different
from port 8000 so you won&rsquo;t have issues running the development server via
<code>python manage.py runserver</code> at the same time as running Lettuce tests.</p>

<p>You also have to create a <code>features</code> directories inside the apps you want to
test with Lettuce:</p>

<pre><code>/myproject
    /myproject
        __init__.py
        settings.py
        urls.py
        wsgi.py
    /polls
        /features
            /steps
                __init__.py
                polls_list.py
            polls_list.feature
        __init__.py
        models.py
        tests.py
        views.py
    manage.py
    requirements.txt
    terrain.py
</code></pre>

<p>Lettuce has its&#8217; own settings file called <code>terrain.py</code>. It has to be in the
same directory as a <code>manage.py</code>:</p>

<pre><code>from django.core.management import call_command
from django.conf import settings
from lettuce import before, after, world
from splinter.browser import Browser

@before.each_scenario
def flush_database(scenario):
    call_command('flush', interactive=False, verbosity=0)

@before.each_scenario
def prepare_browser(scenario):
    world.browser = Browser()

@after.each_scenario
def destroy_browser(scenario):
    world.browser.quit()
</code></pre>

<p>This code flushes the database before each scenario, as well as prepares and
destroys the <code>splinter</code> browser.</p>

<h2>Writing the features</h2>

<p>Feature files support standard Gherkin syntax, let&rsquo;s write one right now in
<code>polls/features/polls_list.feature</code>:</p>

<pre><code>Feature: Polls list

    Scenario: Polls list without any polls
        When I access the "polls list" url
        Then I see a text "We didn't find any polls!"

    Scenario: Polls list with one poll
        Given a poll with the title "Hello world"
        When I access the "polls list" url
        Then I see a text "Hello world"
        And I do not see a text "We didn't find any polls!"
</code></pre>

<p>Now describe the steps in <code>polls/features/steps/polls_list.py</code>:</p>

<pre><code>from django.core.urlresolvers import reverse
from lettuce import step, world
from lettuce.django import django_url
from nose.tools import assert_in, assert_not_in
from polls.models import Poll

PAGES = {
    "polls list": "polls:list"
}

@step(r'access the "(.*)" url')
def access_the_url(step, name):
    world.browser.visit(django_url(reverse(PAGES[name])))

@step(r'see a text "(.*)"')
def see_a_text(step, text):
    assert_in(text, world.browser.html)

@step(r'a poll with the title "(.*)"')
def create_a_poll_with_the_title(step, title):
    poll = Poll.objects.create(title=title)
    polls.save()

@step(r'do not see a text "(.*)"')
def do_not_see_a_text(step, text):
    assert_not_in(text, world.browser.html)
</code></pre>

<h2>Running the tests</h2>

<p>Now, you can run <code>python manage.py harvest --test-server</code> to run the tests you
just wrote:</p>

<pre><code>$ python manage.py harvest --test-server
Creating test database for alias 'default'...
Django's builtin server is running at 0.0.0.0:9000

Feature: Polls list

  Scenario: Polls list without any polls
    When I access the "polls list" url
    Then I see a text "We didn't find any polls!"

  Scenario: Polls list with one poll
    Given a poll with the title "Hello world"
    When I access the "polls list" url
    Then I see a text "Hello world"
    And I do not see a text "We didn't find any polls!"

1 feature (1 passed)
2 scenarios (2 passed)
6 steps (6 passed)
Destroying test database for alias 'default'...
</code></pre>

<p>Don&rsquo;t forget the <code>--test-server</code> switch - otherwise Lettuce will run tests
against your default database.</p>

<h2>Sources</h2>

<p>You can find some more details on Lettuce and Django integration here:
<a href="http://lettuce.it/recipes/django-lxml.html">Web development fun with Lettuce and Django</a>.</p>

<h2>Update</h2>

<p>Rather than using <code>--test-server</code> switch, it&rsquo;s easier and safer to set a flag
in your <code>settings.py</code> (suggested by Michel Sabchuk):</p>

<pre><code>LETTUCE_USE_TEST_DATABASE = True
</code></pre>

<p>This way you won&rsquo;t end up accidentally erasing your production database after
forgetting to add <code>--test-server</code> flag.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-11-25T00:39:34+00:00"  data-updated="true" itemprop="datePublished dateCreated">25 Nov 2013</time>
        
           | <a href="/blog/open-previously-edited-file-in-vim/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/open-previously-edited-file-in-vim/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/open-previously-edited-file-in-vim/" itemprop="url">Open previously edited file in vim</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>You can open previous location by hitting <code>Ctrl-O</code>. You can prefix the command
with a number to go multiple files back. You can also travel forward in &ldquo;file
history&rdquo; by using <code>Ctrl-I</code>.</p>

<p>There&rsquo;s a nice article on <a href="http://vim.wikia.com/wiki/Jumping_to_previously_visited_locations">Vim Wikia</a> with more details on a subject.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-11-24T04:14:19+00:00"  data-updated="true" itemprop="datePublished dateCreated">24 Nov 2013</time>
        
           | <a href="/blog/old-file-version-in-split-with-vim/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/old-file-version-in-split-with-vim/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/old-file-version-in-split-with-vim/" itemprop="url">Old file version in split with vim</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>If you use git VCS, you can view previous version of the file you are currently
editing in a split window by executing following command:</p>

<pre><code>:vsp tmp | read !git show HEAD^:path/from/working/directory
</code></pre>

<p>For the instant syntax highlighting, you can specify temporary file&rsquo;s
extension, like following:</p>

<pre><code>:vsp tmp.py | read !git show HEAD^:lib/module.py
</code></pre>

<p>You can also cycle back by few versions by replacing <code>HEAD^</code> (which points to
the previous commit) with <code>HEAD~N</code>, where <code>N</code> is the number of commits you
would like to go back in history by. For example, if you would like to get a
version of the file 4 commits ago - you can do so by executing following
command:</p>

<pre><code>:vsp tmp | read !git show HEAD~4:path/from/working/directory
</code></pre>

<p>It&rsquo;s a pretty nice hack when you need to quickly view previous version of the
file you are working on.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-11-17T01:02:30+00:00"  data-updated="true" itemprop="datePublished dateCreated">17 Nov 2013</time>
        
           | <a href="/blog/pasting-with-vim-and-indentation-issues/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/pasting-with-vim-and-indentation-issues/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/pasting-with-vim-and-indentation-issues/" itemprop="url">Pasting with vim and indentation issues</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>If you use vim often - you probably had to paste something into vim from the
outside source. And, if you have corresponding indentation rules, they will get
applied, turning your nice block of code into something that looks more like a
case of stairs:</p>

<pre><code>def foo(a, b):
        a, b = b, a
            print "I am doing something important."
                return a - b
</code></pre>

<p>Quite nasty, isn&rsquo;t it? But that&rsquo;s where vim&rsquo;s <code>paste</code> option comes in.  Before
pasting, execute <code>:set paste</code>. If you go into insert mode, you&rsquo;ll see the usual
mode indicator switch to <code>-- INSERT (paste) --</code>. Try pasting the same block of
code now:</p>

<pre><code>def foo(a, b):
    a, b = b, a
    print "I am doing something important."
    return a - b
</code></pre>

<p>Beautiful. Don&rsquo;t forget to switch back to a regular mode by executing <code>:set
nopaste</code>.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-09-12T01:26:15+00:00"  data-updated="true" itemprop="datePublished dateCreated">12 Sep 2013</time>
        
           | <a href="/blog/remap-your-caps-lock/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/remap-your-caps-lock/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/remap-your-caps-lock/" itemprop="url">Remap your Caps Lock</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>The following three paragraphs are an angry <code>Caps Lock</code> rant. Feel free to skip
past it or join me by commenting below.</p>

<p>I&rsquo;ve had it with <code>Caps Lock</code>! How many times did I accidentally press it while
hitting the <code>A</code> key! How many times did I mean <code>Tab</code> or <code>Shift</code>! There is an
obvious problem with the <code>Caps Lock</code> placement, and there being only a
millimeter of space to designate it from an adjacent key, it is quite difficult
to notice when you accidentally press it.</p>

<p>Pushing <code>Caps Lock</code> is more tolerable when typing, but while using keyboard
controlled software it&rsquo;s a real pain; <code>vim</code> turns into a beeping ravaging
nightmare, <code>vimperator</code> messes up all your bookmarks&hellip; Same thing with
websites supporting keyboard shortcuts.</p>

<p>When was the last time I ever used <code>Caps Lock</code>? Over ten years ago, when I was
playing a video game that used <code>Caps Lock</code> to switch between running and
walking. Em&hellip; Seriously? Time to put an end this nonsense.</p>

<h2>Linux and Mac</h2>

<p>Drop this into your <code>~/bin/capslockremap</code>, and don&rsquo;t forget to <code>chmod +x
~/bin/capslockremap</code>. Now run the script with root privileges (that&rsquo;ll last you
until the next restart).</p>

<pre><code>#!/bin/sh

# This temporarily remaps the Caps Lock key to a Control key.
# The keyboard will return to the previous settings after a
# reboot. The Linux console and the X Window system each
# handles keypresses separately, so each must be remapped
# separately. First remap the X keyboard since this does not
# require root access.

# Remap the Caps Lock key to a Control key for
# the X Window system.
if type setxkbmap &gt;/dev/null 2&gt;&amp;1; then
fi

# You have to be root to remap the console keyboard.
if [ "$(id -u)" != "0" ]; then
  echo "This script is not running as root so"
  echo "the console Caps Lock cannot be remapped."
  echo "Perhaps you forgot to run this under sudo."
  echo "Note that this problem does not effect X."
  echo "This only effects the consoles running on"
  echo "Alt-f1 through Alt-f6."
  exit 2
fi
# Remap the CapsLock key to a Control key for the console.
(dumpkeys | grep keymaps; echo "keycode 58 = Control") | loadkeys
</code></pre>

<h2>Windows</h2>

<p>Download <a href="http://technet.microsoft.com/en-us/sysinternals/bb897578.aspx">Sysinternals Ctrl2Cap v2.0</a>, run it as Administrator with
<code>install</code> flag: <code>ctrl2cap.exe /install</code>.</p>

<p>Source <a href="http://www.noah.org/wiki/CapsLock_Remap_Howto">CapsLock Remap Howto - Noah.org</a>.</p>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/posts/16">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archive">Blog Archive</a></li>
      
        <li class="next"><a href="/posts/14">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/the-feedback-fallacy/">The feedback fallacy</a>
    
    <a class="list-group-item " href="/blog/take-a-pause-before-that-email/">Take a pause before that email</a>
    
    <a class="list-group-item " href="/blog/on-mentorship/">On mentorship</a>
    
    <a class="list-group-item " href="/blog/writing-for-fun/">Writing for fun</a>
    
    <a class="list-group-item " href="/blog/vortex-core-keyboard/">Vortex Core 40% keyboard</a>
    
    <a class="list-group-item " href="/blog/one-page-ttrpg-prep/">One page TTRPG prep</a>
    
    <a class="list-group-item " href="/blog/numenera-for-dnd-dms/">Numenera for D&D DMs</a>
    
    <a class="list-group-item " href="/blog/numenera-for-dnd-players/">Numenera for D&D players</a>
    
    <a class="list-group-item " href="/blog/adjusting-to-wfh/">Adjusting to working from home</a>
    
    <a class="list-group-item " href="/blog/how-i-use-vimwiki/">How I use Vimwiki</a>
    
  </div>
</section>
<section>
  <p>
    Hi! My name is Ruslan and I live and work in San Francisco Bay Area,
    California. I’ve recently published a book!
  </p>
  <p>
    <a href="https://amzn.to/2EfGaN5"
       target="blank"><img alt="A picture of Mastering Vim book cover."
                           class="shadow-box"
                           src="/images/mastering-vim.png"
                           title="A picture of Mastering Vim book cover."
                           width="262px" /></a>
  </p>
  <p>
    <a href="https://amzn.to/2EfGaN5" target="blank">Mastering Vim</a> is
    available on Amazon, and I&#8217;d love to hear your thoughts about it!
  </p>
</section>

      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2021 - Ruslan Osipov<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'rosipov';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr.js"></script>


  </body>
</html>
