
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ruslan Osipov</title>
  <meta name="author" content="Ruslan Osipov">

  
  <meta name="description" content="When it comes to tests, doctest is a great simple module to write tests for
your application. However it is pretty basic and does not have any &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ruslanosipov.github.io/posts/7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruslan Osipov" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-48506044-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruslan Osipov</a></h1>
  
    <h2>Thoughts on software development</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ruslanosipov.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/about/">About</a></li>
  <li><a href="/blog/archive/">Archive</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/python-tests-with-doctest-and-unittest/">Python tests with doctest and unittest</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-22T07:47:47-07:00" pubdate data-updated="true">Jul 22<sup>nd</sup>, 2013</time>
        
           | <a href="/blog/python-tests-with-doctest-and-unittest/#disqus_thread"
             data-disqus-identifier="http://ruslanosipov.github.io/blog/python-tests-with-doctest-and-unittest/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When it comes to tests, <code>doctest</code> is a great simple module to write tests for
your application. However it is pretty basic and does not have any extended
features like, for example, centralized unit tests. If you have multiple
modules with doctests (and you probably do) you most likely want to be able to
run all doctests recursively from one place. That&rsquo;s where <code>unittest</code> comes in.</p>

<p>Let&rsquo;s assume we store modules in the <code>lib/</code> directory:</p>

<pre><code>$ ls lib/
__init__.py bar.py foo.py
</code></pre>

<p>Here are the contents of <code>foo.py</code> and <code>bar.py</code> respectfully:</p>

<pre><code>def foo():
    """
    &gt;&gt;&gt; foo()
    False
    """
    return False

def bar():
    """
    &gt;&gt;&gt; bar()
    True
    """
    return True

def baz():
    """
    &gt;&gt;&gt; baz()
    False
    """
    return False
</code></pre>

<p>Now, to run all tests we need a wrapper script. Let&rsquo;s call it: <code>runtests.py</code>:</p>

<pre><code>#!/usr/bin/env python

import unittest
import doctest
import os

files = []
root_dir = 'lib/'

for root, _, filenames in os.walk(root_dir):
    for filename in filenames:
        if filename == '__init__.py' or filename[-3:] != '.py':
            continue
        f = os.path.join(root, filename)
        f = f.replace('/', '.')
        f = f[:-3]
        files.append(f)

suite = unittest.TestSuite()
for module in files:
    suite.addTest(doctest.DocTestSuite(module))
unittest.TextTestRunner(verbosity=1).run(suite)
</code></pre>

<p>This approach invokes the <code>doctest.DocTestSuite</code> method, which converts
doctests strings into unittest suites. Time to run our tests:</p>

<pre><code>$ chmod +x runtests.py
$ ./runtests.py
...
----------------------------------------------------------------------
Ran 3 tests in 0.008s

OK
</code></pre>

<p>And just to be sure that approach actually works, let&rsquo;s make one of the tests
fail:</p>

<pre><code>$ ./runtests.py
.F.
======================================================================
FAIL: baz (lib.bar)
Doctest: lib.bar.baz
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python2.7/doctest.py", line 2201, in runTest
    raise self.failureException(self.format_failure(new.getvalue()))
AssertionError: Failed doctest test for lib.bar.baz
  File "/home/rosipov/unitdoc/lib/bar.py", line 8, in baz

----------------------------------------------------------------------
File "/home/rosipov/unitdoc/lib/bar.py", line 10, in lib.bar.baz
Failed example:
    baz()
Expected:
    True
Got:
    False

----------------------------------------------------------------------
Ran 3 tests in 0.009s

FAILED (failures=1)
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/pygame-font-not-found/">pygame.font not found</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-27T06:51:11-07:00" pubdate data-updated="true">Jun 27<sup>th</sup>, 2013</time>
        
           | <a href="/blog/pygame-font-not-found/#disqus_thread"
             data-disqus-identifier="http://ruslanosipov.github.io/blog/pygame-font-not-found/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I had an issue with pygame not being able to find a dependency for the font
module. After quite a time-consuming search the missing package name was
<code>libsdl-ttf2.0-dev</code>.</p>

<p>Hope this helps someone.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/use-vimdiff-as-git-mergetool/">Use vimdiff as git mergetool</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-13T19:18:16-07:00" pubdate data-updated="true">Jun 13<sup>th</sup>, 2013</time>
        
           | <a href="/blog/use-vimdiff-as-git-mergetool/#disqus_thread"
             data-disqus-identifier="http://ruslanosipov.github.io/blog/use-vimdiff-as-git-mergetool/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Using vimdiff as a git mergetool can be pretty confusing &ndash; multiple windows and
little explanation. This is a short tutorial which explains basic usage, and
what the LOCAL, BASE, and REMOTE keywords mean. This implies that you have at
least a little bit of basic vim knowledge (how to move, save, and switch
between split windows). If you don&rsquo;t, there&rsquo;s a short article for you:
<a href="http://www.rosipov.com/blog/using-vim-for-writing-code/">Using vim for writing code</a>. Some basic understanding of git and branching
is required as well, obviously.</p>

<h2>Git config</h2>

<p>Prior to doing anything, you need to know how to set vimdiff as a git
mergetool. That being said:</p>

<pre><code>git config merge.tool vimdiff
git config merge.conflictstyle diff3
git config mergetool.prompt false
</code></pre>

<p>This will set git as the default merge tool, will display a common ancestor
while merging, and will disable the prompt to open the vimdiff.</p>

<h2>Creating merge conflict</h2>

<p>Let&rsquo;s create a test situation. You are free to skip this part or you can work
along with the tutorial.</p>

<pre><code>mkdir zoo
cd zoo
git init
vi animals.txt
</code></pre>

<p>Let&rsquo;s add some animals:</p>

<pre><code>cat
dog
octopus
octocat
</code></pre>

<p>Save the file.</p>

<pre><code>git add animals.txt
git commit -m "Initial commit"
git branch octodog
git checkout octodog
vi animals.txt  # let's change octopus to octodog
git add animals.txt
git commit -m "Replace octopus with an octodog"
git checkout master
vi animals.txt  # let's change octopus to octoman
git add animals.txt
git commit -m "Replace octopus with an octoman"
git merge octodog  # merge octodog into master
</code></pre>

<p>That&rsquo;s where we get a merge error:</p>

<pre><code>Auto-merging animals.txt
CONFLICT (content): Merge conflict in animals.txt
Automatic merge failed; fix conflicts and then commit the result.
</code></pre>

<h2>Resolving merge conflict with vimdiff</h2>

<p>Let&rsquo;s resolve the conflict:</p>

<pre><code>git mergetool
</code></pre>

<p><img src="/images/three-way-merge-with-vimdiff.png" title="Three-way merge using vimdiff. Local changes are in top left, followed by a common ancestor, and branch `octodog` in the top right corner. Resulting file is at the bottom." ></p>

<p>This looks terrifying at first, but let me explain what is going on.</p>

<p>From left to right, top to the bottom:</p>

<p><code>LOCAL</code> &mdash; this is file from the current branch
<code>BASE</code> &mdash; common ancestor, how file looked before both changes
<code>REMOTE</code> &mdash; file you are merging into your branch
<code>MERGED</code> &mdash; merge result, this is what gets saved in the repo</p>

<p>Let&rsquo;s assume that we want to keep the &ldquo;octodog&rdquo; change (from REMOTE). For that,
move to the MERGED file (<code>Ctrl + w, j</code>), move your cursor to a merge conflict
area and then:</p>

<pre><code>:diffget RE
</code></pre>

<p>This gets the corresponding change from REMOTE and puts it in MERGED file. You
can also:</p>

<pre><code>:diffg RE  " get from REMOTE
:diffg BA  " get from BASE
:diffg LO  " get from LOCAL
</code></pre>

<p>Save the file and quit (a fast way to write and quit multiple files is <code>:wqa</code>).</p>

<p>Run <code>git commit</code> and you are all set!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/git-pretty-log-output/">Git pretty log output</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-13T18:31:02-07:00" pubdate data-updated="true">Jun 13<sup>th</sup>, 2013</time>
        
           | <a href="/blog/git-pretty-log-output/#disqus_thread"
             data-disqus-identifier="http://ruslanosipov.github.io/blog/git-pretty-log-output/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This alias has been around the web for quite some time, but it does look
fantastic indeed.</p>

<p><img src="/images/git-pretty-log.png" title="An output of `git pretty-log` alias." ></p>

<p>To add the alias <code>git pretty-log</code>, execute the following command (join string
prior to executing):</p>

<pre><code>git config alias.pretty-log 'log --graph --pretty=format:"%Cred%h%Creset
-%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset"'
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/download-gists-from-prompt/">Download gists from prompt</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-17T11:52:02-07:00" pubdate data-updated="true">May 17<sup>th</sup>, 2013</time>
        
           | <a href="/blog/download-gists-from-prompt/#disqus_thread"
             data-disqus-identifier="http://ruslanosipov.github.io/blog/download-gists-from-prompt/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I wrote a little script to download gists from the command prompt.</p>

<p>Generate your Github API Token under Settings &ndash;> Applications, change it within
a script, and then:</p>

<pre><code>chmod +x shgist.py
mv shgist.py ~/bin/shgist
</code></pre>

<p>Where ~/bin is a directory in your path. Now you can use it as shgist file to
quickly download your gists (<a href="https://gist.github.com/ruslanosipov/5599377">Gist on Github</a>).</p>

<pre><code>#!/usr/bin/env python

# Ruslan Osipov &lt;ruslan@rosipov.com&gt;
# Usage: shgist keywords
# Description: Gists downloader

import urllib
import urllib2
import sys
import json

token = 'Personal API Access Token'  # Github Settings -&gt; Applications

class Gist:
    def __init__(self, token):
        """
        token -- str, github token
        """
        self.token = token
        self.url = 'https://api.github.com'

    def find_by_name(self, keywords):
        """
        keywords -- list of strings
        """
        gists, urls = self._get_gists()
        for i, gist in enumerate(gists):
            for keyword in keywords:
                if keyword not in gist:
                    del gists[i]
                    del urls[i]
                    break
        if len(gists) == 0:
            print "Sorry, no gists matching your description"
            return
        if len(gists) == 1:
            self._download_gist(gists[0], urls[0])
            return
        for i, gist in enumerate(gists):
            print i, gist
        while True:
            num = raw_input("Gist number, 'q' to quit: ")
            if num == 'q':
                print "Quiting..."
                return
            try:
                num = int(num)
                if 0 &lt;= num &lt; len(gists):
                    break
                print "Number should be within specified range"
            except:
                print "Only integers or 'q' are allowed"
        self._download_gist(gists[num], urls[num])

    def _download_gist(self, name, url):
        """
        name -- str, filename
        url -- str, raw gist url
        """
        print "Downloading %s..." % name
        gist = self._send_get_request(url)
        open(name, 'wb').write(gist)

    def _get_gists(self):
        """
        Returns 2 lists which should be treated as ordered dict
        """
        url = '/gists'
        response = self._send_get_request(self.url + url)
        response = json.loads(response)
        gists, urls = [], []
        for gist in response:
            for name, meta in gist['files'].items():
                gists.append(name)
                urls.append(meta['raw_url'])
        return gists, urls

    def _send_get_request(self, url):
        """
        url -- str
        """
        headers = {
                'Authorization': 'token ' + self.token
                }
        request = urllib2.Request(url, headers=headers)
        response = urllib2.urlopen(request)
        return response.read()

argv = sys.argv[1:]
if not len(argv):
    print "Usage: shgist keywords"
    sys.exit(0)

gist = Gist(token)
gist.find_by_name(argv)
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/8">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/750-words-a-day/">750 words a day</a>
      </li>
    
      <li class="post">
        <a href="/blog/beyond-grep/">Beyond grep</a>
      </li>
    
      <li class="post">
        <a href="/blog/effective-search-with-mutt/">Effective search with Mutt</a>
      </li>
    
      <li class="post">
        <a href="/blog/one-more-argument-for-80-character-limit/">One more argument for 80 character limit</a>
      </li>
    
      <li class="post">
        <a href="/blog/three-favorite-bash-tricks/">Three favorite bash tricks</a>
      </li>
    
      <li class="post">
        <a href="/blog/distraction-free-writing-with-vimroom/">Distraction-free writing with VimRoom</a>
      </li>
    
      <li class="post">
        <a href="/blog/abandoning-wordpress-for-octopress/">Abandoning WordPress for Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-pragmatic-programmer/">&#8220;The Pragmatic Programmer&#8221;</a>
      </li>
    
      <li class="post">
        <a href="/blog/personal-wiki-with-vimwiki/">Personal wiki with vimwiki</a>
      </li>
    
      <li class="post">
        <a href="/blog/easy-commenting-with-tcomment-vim/">Easy commenting with tcomment.vim</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Ruslan Osipov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rosipov';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
