<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
  <meta charset="utf-8">
  <title>Ruslan Osipov</title>
  <meta name="author" content="Ruslan Osipov">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.rosipov.com/posts/11/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="/atom.xml" rel="alternate" title="Ruslan Osipov" type="application/atom+xml">

  <!-- http://opengraphprotocol.org/ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://www.rosipov.com/posts/11/">
  <meta property="og:title" content="Ruslan Osipov">
  

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">


  
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">

  
   <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-48506044-1', 'auto');
    ga('send', 'pageview');

  </script>


</head>

  <body   >
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" title="toggle navbar" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Ruslan Osipov</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="index" href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/about">About</a>
                </li>
                <li >
                    <a href="/blog/archive">Archive</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="/atom.xml" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
                <form class="navbar-form navbar-right" action="https://www.google.com/search" method="GET">
                    <input type="hidden" name="sitesearch" value="www.rosipov.com">
                    <div class="form-group">
                        <input class="form-control" type="text" name="q" placeholder="Search">
                    </div>
                </form>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" role="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index" itemscope itemtype="http://schema.org/Blog">
    <meta itemprop="name" content="Ruslan Osipov" />
    
    <meta itemprop="url" content="http://www.rosipov.com" />
      
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-07-22T14:57:29+00:00"  data-updated="true" itemprop="datePublished dateCreated">Mon 22 Jul 2013,  2:57 PM</time>
        
           | <a href="/blog/python-doctests-and-decorators-bug/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/python-doctests-and-decorators-bug/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/python-doctests-and-decorators-bug/" itemprop="url">Python doctests and decorators bug</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Now, this as well might be a feature, but doctest strings are not being
executed for decorated functions (at least in version 2.7). However, there is a
workaround.</p>

<p>You need to decorate your functions with <code>functools.wraps</code> within a decorator
to import docstrings into a decorator scope.</p>

<pre><code>#!/usr/bin/env python

from functools import wraps

def decorator(func):
    @wraps(func)
    def wrapper():
        return func()
    return wrapper

@decorator
def foo():
    """
    &gt;&gt;&gt; foo()
    False
    """
    return True

import doctest
doctest.testmod()
</code></pre>

<p>Now you can see this test failing, where otherwise it would have been ignored:</p>

<pre><code>**********************************************************************
File "decorator.py", line 12, in __main__.foo
Failed example:
    foo()
Expected:
    False
Got:
    True
**********************************************************************
1 items had failures:
   1 of   1 in __main__.foo
***Test Failed*** 1 failures.
</code></pre>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-07-22T14:47:47+00:00"  data-updated="true" itemprop="datePublished dateCreated">Mon 22 Jul 2013,  2:47 PM</time>
        
           | <a href="/blog/python-tests-with-doctest-and-unittest/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/python-tests-with-doctest-and-unittest/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/python-tests-with-doctest-and-unittest/" itemprop="url">Python tests with doctest and unittest</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>When it comes to tests, <code>doctest</code> is a great simple module to write tests for
your application. However it is pretty basic and does not have any extended
features like, for example, centralized unit tests. If you have multiple
modules with doctests (and you probably do) you most likely want to be able to
run all doctests recursively from one place. That&rsquo;s where <code>unittest</code> comes in.</p>

<p>Let&rsquo;s assume we store modules in the <code>lib/</code> directory:</p>

<pre><code>$ ls lib/
__init__.py bar.py foo.py
</code></pre>

<p>Here are the contents of <code>foo.py</code> and <code>bar.py</code> respectfully:</p>

<pre><code>def foo():
    """
    &gt;&gt;&gt; foo()
    False
    """
    return False

def bar():
    """
    &gt;&gt;&gt; bar()
    True
    """
    return True

def baz():
    """
    &gt;&gt;&gt; baz()
    False
    """
    return False
</code></pre>

<p>Now, to run all tests we need a wrapper script. Let&rsquo;s call it: <code>runtests.py</code>:</p>

<pre><code>#!/usr/bin/env python

import unittest
import doctest
import os

files = []
root_dir = 'lib/'

for root, _, filenames in os.walk(root_dir):
    for filename in filenames:
        if filename == '__init__.py' or filename[-3:] != '.py':
            continue
        f = os.path.join(root, filename)
        f = f.replace('/', '.')
        f = f[:-3]
        files.append(f)

suite = unittest.TestSuite()
for module in files:
    suite.addTest(doctest.DocTestSuite(module))
unittest.TextTestRunner(verbosity=1).run(suite)
</code></pre>

<p>This approach invokes the <code>doctest.DocTestSuite</code> method, which converts
doctests strings into unittest suites. Time to run our tests:</p>

<pre><code>$ chmod +x runtests.py
$ ./runtests.py
...
----------------------------------------------------------------------
Ran 3 tests in 0.008s

OK
</code></pre>

<p>And just to be sure that approach actually works, let&rsquo;s make one of the tests
fail:</p>

<pre><code>$ ./runtests.py
.F.
======================================================================
FAIL: baz (lib.bar)
Doctest: lib.bar.baz
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python2.7/doctest.py", line 2201, in runTest
    raise self.failureException(self.format_failure(new.getvalue()))
AssertionError: Failed doctest test for lib.bar.baz
  File "/home/rosipov/unitdoc/lib/bar.py", line 8, in baz

----------------------------------------------------------------------
File "/home/rosipov/unitdoc/lib/bar.py", line 10, in lib.bar.baz
Failed example:
    baz()
Expected:
    True
Got:
    False

----------------------------------------------------------------------
Ran 3 tests in 0.009s

FAILED (failures=1)
</code></pre>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-06-27T13:51:11+00:00"  data-updated="true" itemprop="datePublished dateCreated">Thu 27 Jun 2013,  1:51 PM</time>
        
           | <a href="/blog/pygame-font-not-found/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/pygame-font-not-found/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/pygame-font-not-found/" itemprop="url">pygame.font not found</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>I had an issue with pygame not being able to find a dependency for the font
module. After quite a time-consuming search the missing package name was
<code>libsdl-ttf2.0-dev</code>.</p>

<p>Hope this helps someone.</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-06-14T02:18:16+00:00"  data-updated="true" itemprop="datePublished dateCreated">Fri 14 Jun 2013,  2:18 AM</time>
        
           | <a href="/blog/use-vimdiff-as-git-mergetool/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/use-vimdiff-as-git-mergetool/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/use-vimdiff-as-git-mergetool/" itemprop="url">Use vimdiff as git mergetool</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>Using vimdiff as a git mergetool can be pretty confusing - multiple windows and
little explanation. This is a short tutorial which explains basic usage, and
what the LOCAL, BASE, and REMOTE keywords mean. This implies that you have at
least a little bit of basic vim knowledge (how to move, save, and switch
between split windows). If you don&rsquo;t, there&rsquo;s a short article for you:
<a href="http://www.rosipov.com/blog/using-vim-for-writing-code/">Using vim for writing code</a>. Some basic understanding of git and branching
is required as well, obviously.</p>

<h2>Git config</h2>

<p>Prior to doing anything, you need to know how to set vimdiff as a git
mergetool. That being said:</p>

<pre><code>git config merge.tool vimdiff
git config merge.conflictstyle diff3
git config mergetool.prompt false
</code></pre>

<p>This will set git as the default merge tool, will display a common ancestor
while merging, and will disable the prompt to open the vimdiff.</p>

<h2>Creating merge conflict</h2>

<p>Let&rsquo;s create a test situation. You are free to skip this part or you can work
along with the tutorial.</p>

<pre><code>mkdir zoo
cd zoo
git init
vi animals.txt
</code></pre>

<p>Let&rsquo;s add some animals:</p>

<pre><code>cat
dog
octopus
octocat
</code></pre>

<p>Save the file.</p>

<pre><code>git add animals.txt
git commit -m "Initial commit"
git branch octodog
git checkout octodog
vi animals.txt  # let's change octopus to octodog
git add animals.txt
git commit -m "Replace octopus with an octodog"
git checkout master
vi animals.txt  # let's change octopus to octoman
git add animals.txt
git commit -m "Replace octopus with an octoman"
git merge octodog  # merge octodog into master
</code></pre>

<p>That&rsquo;s where we get a merge error:</p>

<pre><code>Auto-merging animals.txt
CONFLICT (content): Merge conflict in animals.txt
Automatic merge failed; fix conflicts and then commit the result.
</code></pre>

<h2>Resolving merge conflict with vimdiff</h2>

<p>Let&rsquo;s resolve the conflict:</p>

<pre><code>git mergetool
</code></pre>

<p><img src="/images/posts/three-way-merge-with-vimdiff.png" title="Three-way merge using vimdiff. Local changes are in top left, followed by a common ancestor, and branch `octodog` in the top right corner. Resulting file is at the bottom." ></p>

<p>This looks terrifying at first, but let me explain what is going on.</p>

<p>From left to right, top to the bottom:</p>

<p><code>LOCAL</code> &ndash; this is file from the current branch
<code>BASE</code> &ndash; common ancestor, how file looked before both changes
<code>REMOTE</code> &ndash; file you are merging into your branch
<code>MERGED</code> &ndash; merge result, this is what gets saved in the repo</p>

<p>Let&rsquo;s assume that we want to keep the &ldquo;octodog&rdquo; change (from REMOTE). For that,
move to the MERGED file (<code>Ctrl + w, j</code>), move your cursor to a merge conflict
area and then:</p>

<pre><code>:diffget RE
</code></pre>

<p>This gets the corresponding change from REMOTE and puts it in MERGED file. You
can also:</p>

<pre><code>:diffg RE  " get from REMOTE
:diffg BA  " get from BASE
:diffg LO  " get from LOCAL
</code></pre>

<p>Save the file and quit (a fast way to write and quit multiple files is <code>:wqa</code>).</p>

<p>Run <code>git commit</code> and you are all set!</p>
</div>
  
  


        </article>
      
      
        <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2013-06-14T01:31:02+00:00"  data-updated="true" itemprop="datePublished dateCreated">Fri 14 Jun 2013,  1:31 AM</time>
        
           | <a href="/blog/git-pretty-log-output/#disqus_thread" itemprop="discussionUrl"
             data-disqus-identifier="http://www.rosipov.com/blog/git-pretty-log-output/">Comments</a>
        
      </p>
    
    
      <h2 class="entry-title" itemprop="name headline"><a href="/blog/git-pretty-log-output/" itemprop="url">Git pretty log output</a></h2>
    
  </header>


  <div class="entry-content clearfix" itemprop="articleBody description"><p>This alias has been around the web for quite some time, but it does look
fantastic indeed.</p>

<p><img src="/images/posts/git-pretty-log.png" title="An output of `git pretty-log` alias." ></p>

<p>To add the alias <code>git pretty-log</code>, execute the following command (join string
prior to executing):</p>

<pre><code>git config alias.pretty-log 'log --graph --pretty=format:"%Cred%h%Creset
-%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset"'
</code></pre>
</div>
  
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous"><a href="/posts/12">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archive">Blog Archive</a></li>
      
        <li class="next"><a href="/posts/10">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/a-year-with-pebble-time-round/">A year with Pebble Time Round</a>
    
    <a class="list-group-item " href="/blog/mob-level-distribution/">Mob level distribution</a>
    
    <a class="list-group-item " href="/blog/spawning-evenly-distributed-mobs/">Spawning evenly distributed mobs</a>
    
    <a class="list-group-item " href="/blog/randomly-generated-dungeons/">Randomly generated dungeons</a>
    
    <a class="list-group-item " href="/blog/browsing-mssql-and-vertica-from-cli/">Browsing MSSQL and Vertica from CLI</a>
    
    <a class="list-group-item " href="/blog/thoughts-on-travel/">Thoughts on travel</a>
    
    <a class="list-group-item " href="/blog/living-in-a-car-for-5000-miles/">Living in a car for 5000 miles</a>
    
    <a class="list-group-item " href="/blog/prius-camper-conversion/">Prius camper conversion</a>
    
    <a class="list-group-item " href="/blog/urban-prius-living/">Urban Prius living</a>
    
    <a class="list-group-item " href="/blog/my-experience-with-minimalism/">My experience with minimalism</a>
    
  </div>
</section>

      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2016 - Ruslan Osipov<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'rosipov';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




  </body>
</html>
