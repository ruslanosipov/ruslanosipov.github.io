
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Python tests with doctest and unittest - Ruslan Osipov</title>
  <meta name="author" content="Ruslan Osipov">

  
  <meta name="description" content="When it comes to tests, doctest is a great simple module to write tests for
your application. However it is pretty basic and does not have any &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ruslanosipov.github.io/blog/python-tests-with-doctest-and-unittest">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Ruslan Osipov" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-48506044-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ruslan Osipov</a></h1>
  
    <h2>Thoughts on software development</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ruslanosipov.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/about/">About</a></li>
  <li><a href="/blog/archive/">Archive</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Python tests with doctest and unittest</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-22T07:47:47-07:00" pubdate data-updated="true">Jul 22<sup>nd</sup>, 2013</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://ruslanosipov.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>When it comes to tests, <code>doctest</code> is a great simple module to write tests for
your application. However it is pretty basic and does not have any extended
features like, for example, centralized unit tests. If you have multiple
modules with doctests (and you probably do) you most likely want to be able to
run all doctests recursively from one place. That&rsquo;s where <code>unittest</code> comes in.</p>

<p>Let&rsquo;s assume we store modules in the <code>lib/</code> directory:</p>

<pre><code>$ ls lib/
__init__.py bar.py foo.py
</code></pre>

<p>Here are the contents of <code>foo.py</code> and <code>bar.py</code> respectfully:</p>

<pre><code>def foo():
    """
    &gt;&gt;&gt; foo()
    False
    """
    return False

def bar():
    """
    &gt;&gt;&gt; bar()
    True
    """
    return True

def baz():
    """
    &gt;&gt;&gt; baz()
    False
    """
    return False
</code></pre>

<p>Now, to run all tests we need a wrapper script. Let&rsquo;s call it: <code>runtests.py</code>:</p>

<pre><code>#!/usr/bin/env python

import unittest
import doctest
import os

files = []
root_dir = 'lib/'

for root, _, filenames in os.walk(root_dir):
    for filename in filenames:
        if filename == '__init__.py' or filename[-3:] != '.py':
            continue
        f = os.path.join(root, filename)
        f = f.replace('/', '.')
        f = f[:-3]
        files.append(f)

suite = unittest.TestSuite()
for module in files:
    suite.addTest(doctest.DocTestSuite(module))
unittest.TextTestRunner(verbosity=1).run(suite)
</code></pre>

<p>This approach invokes the <code>doctest.DocTestSuite</code> method, which converts
doctests strings into unittest suites. Time to run our tests:</p>

<pre><code>$ chmod +x runtests.py
$ ./runtests.py
...
----------------------------------------------------------------------
Ran 3 tests in 0.008s

OK
</code></pre>

<p>And just to be sure that approach actually works, let&rsquo;s make one of the tests
fail:</p>

<pre><code>$ ./runtests.py
.F.
======================================================================
FAIL: baz (lib.bar)
Doctest: lib.bar.baz
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/lib/python2.7/doctest.py", line 2201, in runTest
    raise self.failureException(self.format_failure(new.getvalue()))
AssertionError: Failed doctest test for lib.bar.baz
  File "/home/rosipov/unitdoc/lib/bar.py", line 8, in baz

----------------------------------------------------------------------
File "/home/rosipov/unitdoc/lib/bar.py", line 10, in lib.bar.baz
Failed example:
    baz()
Expected:
    True
Got:
    False

----------------------------------------------------------------------
Ran 3 tests in 0.009s

FAILED (failures=1)
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ruslan Osipov</span></span>

      








  


<time datetime="2013-07-22T07:47:47-07:00" pubdate data-updated="true">Jul 22<sup>nd</sup>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://ruslanosipov.github.io/blog/python-tests-with-doctest-and-unittest/" data-via="antistatuquo" data-counturl="http://ruslanosipov.github.io/blog/python-tests-with-doctest-and-unittest/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/pygame-font-not-found/" title="Previous Post: pygame.font not found">&laquo; pygame.font not found</a>
      
      
        <a class="basic-alignment right" href="/blog/python-doctests-and-decorators-bug/" title="Next Post: Python doctests and decorators bug">Python doctests and decorators bug &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/abandoning-wordpress-for-octopress/">Abandoning WordPress for Octopress</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-pragmatic-programmer/">"The Pragmatic Programmer"</a>
      </li>
    
      <li class="post">
        <a href="/blog/personal-wiki-with-vimwiki/">Personal wiki with vimwiki</a>
      </li>
    
      <li class="post">
        <a href="/blog/easy-commenting-with-tcomment-vim/">Easy commenting with tcomment.vim</a>
      </li>
    
      <li class="post">
        <a href="/blog/zero-mail-inbox/">Zero mail inbox</a>
      </li>
    
      <li class="post">
        <a href="/blog/dark-side-of-technical-interviews/">Dark side of technical interviews</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-elements-of-style/">"The Elements Of Style"</a>
      </li>
    
      <li class="post">
        <a href="/blog/expert-python-programming-by-tarek-ziade/">"Expert Python Programming" by Tarek Ziade</a>
      </li>
    
      <li class="post">
        <a href="/blog/steve-krugs-dont-make-me-think/">Steve Krug's "Don't Make Me Think"</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-design-of-everyday-things/">"The Design of Everyday Things"</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Ruslan Osipov -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'rosipov';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ruslanosipov.github.io/blog/python-tests-with-doctest-and-unittest/';
        var disqus_url = 'http://ruslanosipov.github.io/blog/python-tests-with-doctest-and-unittest/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
